## Process this file with automake to produce Makefile.in

SUBDIRS = docs src 

if DISABLE_GNOME
else
SUBDIRS += src/schemas src/xml src/kpengine src/img src/desktop po
endif


ACLOCAL_AMFLAGS = -I m4

PACKAGE = @PACKAGE@
VERSION = @VERSION@
top_srcdir = @top_srcdir@
ARCH = @ARCH@

DPKG_DEB=@DPKG_DEB@
RPMBUILD=@RPMBUILD@
RPM_SOURCE=`@RPMDIR@ --eval '%{_sourcedir}'`
RPM_RPMS=`@RPMDIR@ --eval '%{_rpmdir}'`

news_DATA = NEWS
copying_DATA = COPYING
changelog_DATA = ChangeLog
newsdir = $(docdir)-@VERSION@
copyingdir = $(docdir)-@VERSION@
changelogdir = $(docdir)-@VERSION@

CONFIGURE_OPTIONS = --prefix $(prefix) --bindir=$(bindir) --sbindir=$(sbindir) --libexecdir=$(libexecdir) --sysconfdir=$(sysconfdir) --sharedstatedir=$(sharedstatedir) --localstatedir=$(localstatedir) --libdir=$(libdir) --includedir=$(includedir) --oldincludedir=$(oldincludedir) --datarootdir=$(datarootdir) --datadir=$(datadir) --infodir=$(infodir) --localedir=$(localedir) --mandir=$(mandir) --docdir=$(docdir)

distclean-local:
	@ rm -rf $(top_srcdir)/debian

deb: dist
	@ rm -rf $(top_srcdir)/debian
	@ cp -R $(top_srcdir)/deb $(top_srcdir)/debian
	@ rm $(top_srcdir)/debian/DEBIAN/*.in
	@ cp $(top_srcdir)/ChangeLog $(top_srcdir)/debian/DEBIAN/changelog
	@ cp $(top_srcdir)/COPYING $(top_srcdir)/debian/DEBIAN/copyright
	@ $(top_srcdir)/configure $(CONFIGURE_OPTIONS) --disable-schemas-install > /dev/null
	@ make clean > /dev/null
	@ make
	@ chmod a+x $(top_srcdir)/debian/DEBIAN/postinst
	@ chmod a+x $(top_srcdir)/debian/DEBIAN/prerm
	@ make DESTDIR=$(PWD)/debian install
	@ ${DPKG_DEB} --build debian > /dev/null
	@ mv $(top_srcdir)/debian.deb $(top_srcdir)/$(PACKAGE)-$(VERSION)-$(RELEASE).$(ARCH).deb
	@ rm -rf $(top_srcdir)/debian
	@ echo "Success! Finished creating the deb package.  Please have a sugary day."

ubuntu-deb:
	@ $(top_srcdir)/configure --prefix /usr --sysconfdir /etc > /dev/null
	@ make deb
  

rpm: dist
	@ make clean > /dev/null
	@ echo "%_topdir $(PWD)/rpm" > $(HOME)/.rpmmacros
	@ mkdir -p $(top_srcdir)/rpm/SOURCES $(top_srcdir)/rpm/SPECS $(top_srcdir)/rpm/BUILD $(top_srcdir)/rpm/RPMS/@ARCH@ $(top_srcdir)/rpm/SRPMS/@ARCH@
	@ cp @PACKAGE@-@VERSION@.tar.gz $(top_srcdir)/rpm/SOURCES
	@ ${RPMBUILD} -ba --target @ARCH@ $(top_srcdir)/rpm/@PACKAGE@.spec
	@ cp $(RPM_RPMS)/@ARCH@/@PACKAGE@-@VERSION@-@RELEASE@.@ARCH@.rpm $(top_srcdir)
	@ rm -rf $(top_srcdir)/rpm/SOURCES $(top_srcdir)/rpm/SPECS $(top_srcdir)/rpm/BUILD $(top_srcdir)/rpm/RPMS $(top_srcdir)/rpm/SRPMS
	@ echo "Success! Finished creating the rpm packge. Please have a sugary day."

fedora-rpm:
	@ $(top_srcdir)/configure --prefix /usr --sysconfdir /etc > /dev/null
	@ make rpm

EXTRA_DIST = config.rpath m4/ChangeLog config.rpath m4/ChangeLog deb/DEBIAN/rules


uninstall-local:
	@ rm -rf $(DESTDIR)$(docdir)-@VERSION@
	@ rm -rf $(DESTDIR)$(datadir)/@PACKAGE@
